# Specification Generator
Генератор спецификаций QR кодов из мастер файла

Этот проект представляет собой Python-скрипт, реализованный в виде класса `SpecificationGenerator`, который создает спецификацию на основе данных из двух файлов Excel (мастер-файл номенклатуры и файл QR-кодов FORT) и сохраняет результат в новый файл, используя шаблон спецификации.

## Назначение

Скрипт предназначен для:
- Обработки данных о товарах из мастер-файла и QR-кодов из файла FORT_QR
- Сопоставления кодов GTIN между мастер-файлом и файлом QR-кодов
- Группировки товаров по иерархии: пачка → коробка → мастер-кейс → паллет
- Валидации корректности распределения товаров по упаковкам (SIZE5 и SIZE2)
- Формирования итоговой спецификации с кодами идентификации
- Сохранения результата в новый файл Excel с уникальным именем и временной меткой

## Структура данных

#### Входные файлы:
- **Мастер-файл номенклатуры** - содержит информацию о товарах, GTIN кодах и размерах упаковок
- **FORT_QR файл** - содержит QR-коды маркировки с кодами идентификации
- **Шаблон спецификации** - базовый шаблон для выходного файла

### Ключевые поля:
- `GTIN` - код товара (пачка)
- `GTIN Outer` - код коробки
- `GTIN Case` - код мастер-кейса
- `SIZE5` - количество пачек в коробке
- `SIZE2` - количество мастер-кейсов на паллете
- `identificationCode` - код идентификации для маркировки

## Зависимости

Для работы скрипта требуются следующие библиотеки:
- `pandas` — для работы с данными в формате таблиц
- `openpyxl` — для чтения и записи файлов Excel
- `shutil` — для копирования файлов
- `datetime` — для генерации уникальных имен файлов с временной меткой

Установка зависимостей с использованием `uv`:
```bash
uv venv
source .venv/bin/activate  # Linux/MacOS, или .venv\Scripts\activate для Windows
uv pip install pandas openpyxl
```
## Способ запуска

Использование функции-обертки
```
def generate_specification(master_file_path, fort_qr_path, template_path):
    generator = SpecificationGenerator(master_file_path, fort_qr_path, template_path)
    master_file, fort_qr = generator.load_data()
    row_count = generator.process_data(master_file, fort_qr)
    generator.save_to_excel(row_count)
    return generator.new_filename

result_file = generate_specification(
    "Мастер файл номенклатуры.xlsx",
    "FORT_QR_20250326145347.xlsx", 
    "Invoice Specification template.xlsx"
)
```

## Особенности работы
- Валидация данных: Скрипт проверяет корректность распределения товаров по упаковкам
- Обработка остатков: Если количество пачек не делится нацело на SIZE5, или мастер-кейсов на SIZE2, скрипт останавливается с ошибкой
- Отладочная информация: Выводятся данные о найденных совпадениях GTIN кодов и процессе обработки
- Сохранение шаблона: Исходный шаблон не изменяется, данные записываются в новый файл
- Уникальные имена: Выходные файлы получают уникальные имена с временной меткой

## Структура выходного файла
Результирующая спецификация содержит следующие колонки:

- productNameRus - название товара на русском
- productNameEng - название товара на английском
- identificationCode - код идентификации пачки
- identificationCodeOuter - код идентификации коробки
- identificationCodeCase - код идентификации мастер-кейса
- identificationCodePallet - код идентификации паллета
- invoiceNo - номер инвойса
- invoiceDate - дата инвойса
- TotalAmount - общая сумма

## Использование
1. Поместите входные файлы в директорию со скриптом:

    - Мастер-файл номенклатуры (Excel)
    - Файл FORT_QR с QR-кодами (Excel)
    - Шаблон спецификации (Excel)
    - Установите зависимости:
2. Установите зависимости:
```
uv pip install pandas openpyxl
```
3. Запустите скрипт:
```
python script.py
```
4. Результат будет сохранен в файл с именем вида 
```
Invoice_Specification_YYYYMMDD_HHMMSS.xlsx
```

## Обработка ошибок
Скрипт включает валидацию данных и выводит подробные сообщения об ошибках:

- Проверка существования и корректности входных файлов
- Валидация распределения товаров по упаковкам
- Контроль целостности данных при сопоставлении GTIN кодов
- Информативные сообщения о процессе обработки